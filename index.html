<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>起始页</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --search-bg: #f0f0f0;
            --settings-bg: #ffffff;
            --blur: 5px;
            --blur-bg: rgba(128, 128, 128, 0.3);
        }

        body.dark-mode {
            --bg-color: #000000;
            --text-color: #ffffff;
            --search-bg: #333333;
            --settings-bg: #1a1a1a;
            --blur-bg: rgba(64, 64, 64, 0.3);
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        #search-container {
            text-align: center;
        }

        #search-input {
            width: 300px;
            padding: 10px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background-color: var(--search-bg);
            color: var(--text-color);
        }

        #settings-button {
            position: fixed;
            top: 20px;
            right: 20px;
            cursor: pointer;
            font-size: 24px;
        }

        #settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: var(--settings-bg);
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }

        #settings-panel h2 {
            margin-top: 0;
        }

        #settings-panel label {
            display: block;
            margin-top: 10px;
        }

        #settings-panel select, #settings-panel input {
            width: 100%;
            padding: 5px;
            margin-top: 5px;
        }

        #main-content {
            transition: filter 0.3s ease;
        }

        .blur {
            filter: blur(var(--blur));
        }

        .blur::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--blur-bg);
            z-index: -1;
        }
    </style>
</head>
<body>
    <div id="main-content">
        <div id="search-container">
            <input type="text" id="search-input" placeholder="搜索...">
        </div>
    </div>

    <div id="settings-button">☰</div>

    <div id="settings-panel">
        <h2>设置</h2>
        <label for="search-engine">搜索引擎：</label>
        <select id="search-engine">
            <option value="baidu">百度</option>
            <option value="google">Google</option>
            <option value="bing">Bing</option>
            <option value="duckduckgo">DuckDuckGo</option>
            <option value="wikipedia">Wikipedia</option>
            <option value="wz">中文维基百科</option>
            <option value="wzm">维基百科镜像</option>
            <option value="custom">自定义</option>
        </select>

        <div id="custom-search-container" style="display: none;">
            <label for="custom-search-url">自定义搜索 URL：</label>
            <input type="text" id="custom-search-url" placeholder="https://example.com/search?q=">
        </div>

        <label for="language">语言：</label>
        <select id="language">
            <option value="zh-CN">中文</option>
            <option value="en">English</option>
            <option value="fr">Français</option>
        </select>

        <label for="theme">主题：</label>
        <select id="theme">
            <option value="light">亮色模式</option>
            <option value="dark">暗色模式</option>
        </select>

        <label for="search-size">搜索框大小：</label>
        <input type="range" id="search-size" min="200" max="500" step="10" value="300">
    </div>

    <script>
        const searchInput = document.getElementById('search-input');
        const settingsButton = document.getElementById('settings-button');
        const settingsPanel = document.getElementById('settings-panel');
        const mainContent = document.getElementById('main-content');
        const searchEngine = document.getElementById('search-engine');
        const customSearchContainer = document.getElementById('custom-search-container');
        const customSearchUrl = document.getElementById('custom-search-url');
        const language = document.getElementById('language');
        const theme = document.getElementById('theme');
        const searchSize = document.getElementById('search-size');

        // 加载保存的设置
        function loadSettings() {
            const savedSettings = JSON.parse(localStorage.getItem('startPageSettings')) || {};
            searchEngine.value = savedSettings.searchEngine || getDefaultSearchEngine();
            customSearchUrl.value = savedSettings.customSearchUrl || '';
            language.value = savedSettings.language || 'zh-CN';
            theme.value = savedSettings.theme || 'light';
            searchSize.value = savedSettings.searchSize || '300';

            updateCustomSearchVisibility();
            applyTheme();
            applySearchSize();
            applyLanguage();
        }

        // 保存设置
        function saveSettings() {
            const settings = {
                searchEngine: searchEngine.value,
                customSearchUrl: customSearchUrl.value,
                language: language.value,
                theme: theme.value,
                searchSize: searchSize.value
            };
            localStorage.setItem('startPageSettings', JSON.stringify(settings));
        }

        // 获取默认搜索引擎
        function getDefaultSearchEngine() {
            return isInChina() ? 'baidu' : 'duckduckgo';
        }

        // 检查是否在中国大陆（这里使用一个简单的模拟，实际应用中需要更复杂的检测方法）
        function isInChina() {
            // 这里应该使用实际的 IP 地理位置检测
            // 为了演示，我们随机返回 true 或 false
            return Math.random() < 0.5;
        }

        // 更新自定义搜索 URL 输入框的可见性
        function updateCustomSearchVisibility() {
            customSearchContainer.style.display = searchEngine.value === 'custom' ? 'block' : 'none';
        }

        // 应用主题
        function applyTheme() {
            document.body.classList.toggle('dark-mode', theme.value === 'dark');
        }

        // 应用搜索框大小
        function applySearchSize() {
            searchInput.style.width = `${searchSize.value}px`;
        }

        // 应用语言
        function applyLanguage() {
            document.documentElement.lang = language.value;
            // 更新界面文本
            updateInterfaceText();
        }

        // 更新界面文本
        function updateInterfaceText() {
            const texts = {
                'zh-CN': {
                    searchPlaceholder: '搜索...',
                    settings: '设置',
                    searchEngine: '搜索引擎：',
                    customSearchUrl: '自定义搜索 URL：',
                    language: '语言：',
                    theme: '主题：',
                    lightMode: '亮色模式',
                    darkMode: '暗色模式',
                    searchSize: '搜索框大小：'
                },
                'en': {
                    searchPlaceholder: 'Search...',
                    settings: 'Settings',
                    searchEngine: 'Search Engine:',
                    customSearchUrl: 'Custom Search URL:',
                    language: 'Language:',
                    theme: 'Theme:',
                    lightMode: 'Light Mode',
                    darkMode: 'Dark Mode',
                    searchSize: 'Search Box Size:'
                },
                'fr': {
                    searchPlaceholder: 'Rechercher...',
                    settings: 'Paramètres',
                    searchEngine: 'Moteur de recherche :',
                    customSearchUrl: 'URL de recherche personnalisée :',
                    language: 'Langue :',
                    theme: 'Thème :',
                    lightMode: 'Mode clair',
                    darkMode: 'Mode sombre',
                    searchSize: 'Taille de la barre de recherche :'
                }
            };

            const currentLang = language.value;
            const t = texts[currentLang];

            searchInput.placeholder = t.searchPlaceholder;
            document.querySelector('#settings-panel h2').textContent = t.settings;
            document.querySelector('label[for="search-engine"]').textContent = t.searchEngine;
            document.querySelector('label[for="custom-search-url"]').textContent = t.customSearchUrl;
            document.querySelector('label[for="language"]').textContent = t.language;
            document.querySelector('label[for="theme"]').textContent = t.theme;
            document.querySelector('label[for="search-size"]').textContent = t.searchSize;

            const themeOptions = document.querySelectorAll('#theme option');
            themeOptions[0].textContent = t.lightMode;
            themeOptions[1].textContent = t.darkMode;
        }

        // 执行搜索
        function performSearch() {
            const query = encodeURIComponent(searchInput.value);
            let searchUrl;

            switch (searchEngine.value) {
                case 'baidu':
                    searchUrl = `https://www.baidu.com/s?wd=${query}`;
                    break;
                case 'wz':
                    searchUrl = `https://zh.wikipedia.org/w/index.php?search=${query}`;
                    break;
                case 'wzm':
                    searchUrl = `https://w.joyance.page/w/index.php?search=${query}`;
                    break;
                case 'google':
                    searchUrl = `https://www.google.com/search?q=${query}`;
                    break;
                case 'bing':
                    searchUrl = `https://www.bing.com/search?q=${query}`;
                    break;
                case 'duckduckgo':
                    searchUrl = `https://duckduckgo.com/?q=${query}`;
                    break;
                case 'wikipedia':
                    searchUrl = `https://en.wikipedia.org/w/index.php?search=${query}`;
                    break;
                case 'custom':
                    searchUrl = customSearchUrl.value + query;
                    break;
            }

            window.location.href = searchUrl;
        }

        // 事件监听器
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        settingsButton.addEventListener('click', () => {
            settingsPanel.style.right = '0';
            mainContent.classList.add('blur');
        });

        document.addEventListener('click', (e) => {
            if (!settingsPanel.contains(e.target) && e.target !== settingsButton) {
                settingsPanel.style.right = '-300px';
                mainContent.classList.remove('blur');
            }
        });

        searchEngine.addEventListener('change', () => {
            updateCustomSearchVisibility();
            saveSettings();
        });

        customSearchUrl.addEventListener('input', saveSettings);
        language.addEventListener('change', () => {
            applyLanguage();
            saveSettings();
        });

        theme.addEventListener('change', () => {
            applyTheme();
            saveSettings();
        });

        searchSize.addEventListener('input', () => {
            applySearchSize();
            saveSettings();
        });

        // 初始化
        loadSettings();
    </script>
</body>
</html>
